<!doctype html>
<html>
	<head>
		<title>Goban</title>
		<meta charset="utf-8" />
		<script>
			var Goban = (function() {
				var exports = {};

				exports.Board = function (options)
				{
					var self = {};

					self.size = options.size;

					return self;
				};

				exports.CanvasView = function(options) {
					var self = {};

					self.backgroundColor = options.backgroundColor ? options.backgroundColor : 'rgb(172, 130, 70)';

					self.dom = options.document.getElementById(options.id);
					self.canvas = self.dom.getContext('2d');

					self.render = function(board) {
						self.writeBoard(board);
					};

					self.writeBoard = function(board) {
						self.writeBackground(board);
						self.canvas.fillStyle = 'rgb(0, 0, 0)';
						self.canvas.strokeStyle = 'rgb(0, 0, 0)';

						var unit_height = self.dom.height / board.size;
						var unit_width = self.dom.width / board.size;

						// vertical line
						for (var i = 0; i < board.size; i++ ) {
							self.canvas.beginPath();
							var start_coordinate = self.getCoordinate(board, i, 0);
							self.canvas.moveTo(start_coordinate[0], start_coordinate[1]);
							var finish_coordinate = self.getCoordinate(board, i, board.size - 1);
							self.canvas.lineTo(finish_coordinate[0], finish_coordinate[1]);
							self.canvas.closePath();
							self.canvas.stroke();
						}

						// horizontal line
						for (var j = 0; j < board.size; j++ ) {
							self.canvas.beginPath();
							var start_coordinate = self.getCoordinate(board, 0, j);
							self.canvas.moveTo(start_coordinate[0], start_coordinate[1]);
							var finish_coordinate = self.getCoordinate(board, board.size - 1, j);
							self.canvas.lineTo(finish_coordinate[0], finish_coordinate[1]);
							self.canvas.closePath();
							self.canvas.stroke();
						}

						var radius = 2;
						switch (board.size) {
							case 9:
								self.point(board, 2, 2, radius);
								self.point(board, 2, 5-1, radius);
								self.point(board, 2, 9-1-2, radius);
								self.point(board, 5-1, 9-1-2, radius);
								self.point(board, 9-1-2, 9-1-2, radius);
								self.point(board, 9-1-2, 5-1, radius);
								self.point(board, 9-1-2, 2, radius);
								self.point(board, 5-1, 2,radius);

								self.point(board, 5-1, 5-1,radius);
								break;
							case 13:
								// TODO
								break;
							case 19:
								self.point(board, 3, 3, radius);
								self.point(board, 3, 10-1, radius);
								self.point(board, 3, 19-1-3, radius);
								self.point(board, 10-1, 19-1-3, radius);
								self.point(board, 19-1-3, 19-1-3, radius);
								self.point(board, 19-1-3, 10-1, radius);
								self.point(board, 19-1-3, 3, radius);
								self.point(board, 10-1, 3, radius);
								self.point(board, 10-1, 10-1, radius);
								break;
							default:
								break;
						}
					};

					self.point = function(board, x, y, r) {
						var coordinates = self.getCoordinate(board, x, y);
						self.canvas.beginPath();
						self.canvas.arc(coordinates[0], coordinates[1], r, 0, Math.PI * 2, false);
						self.canvas.stroke();
					};

					// return real coordinates from virtual coodinate.
					self.getCoordinate = function(board, x, y) {
						var unit_height = self.dom.height / board.size;
						var unit_width = self.dom.width / board.size;
						return [unit_width / 2 + unit_width * x, unit_height / 2 + unit_height * y];
					}

					self.writeBackground = function(board) {
						self.canvas.fillStyle = self.backgroundColor;
						self.canvas.fillRect(0, 0, self.dom.width, self.dom.height);
					}

					return self;
				};

				return exports;
			})();
		</script>
	</head>
	<body>
		<p>碁盤アプリのデモです</p>
		<canvas id="goban" width="300" height="300" />
		<script>
			var canvas = document.getElementById('goban');
			var board = new Goban.Board({
				size: 9,
			});

			var view = Goban.CanvasView({
				'document': document,
				id: 'goban',
			});
			view.render(board);
		</script>
	</body>
</html>
